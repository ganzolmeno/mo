"use strict";(self.webpackChunkng_rpgmo_website=self.webpackChunkng_rpgmo_website||[]).push([[533],{8533:(q,M,u)=>{u.r(M),u.d(M,{HighscoreModule:()=>D});var _=u(6895),y=u(6762),x=u(4006),n=u(1571);function b(o,c,e,t,i,s,l){try{var r=o[s](l),a=r.value}catch(h){return void e(h)}r.done?c(a):Promise.resolve(a).then(t,i)}var P=u(1135),T=u(4128),g=u(1437),k=u(529);let S=(()=>{class o{constructor(e,t,i){this.location=e,this.http=t,this.platformId=i,this.highscore_url="https://rpg-de2.mo.ee/",this.charjs_url="https://data.mo.ee/",this.dict={noData:"\u6C92\u6709\u6578\u64DA\u3002",err:"\u8F09\u5165\u9AD8\u5206\u699C\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u5617\u8A66\u3002"},this.requestState=new P.X(d.NONE),this.snapShot=[],this.playerScores={},this.outputData=[],this.brMode="solo",this.brStat="wins",this.page=0,this.optionNodeTree={},this.nodeGeneric={\u03a6\u03a6type:"option",\u03a6\u03a6default:"page",\u03a6\u03a6next:!0,page:{\u03a6\u03a6default:0,\u03a6\u03a6type:"number"},rank:{\u03a6\u03a6default:0,\u03a6\u03a6type:"number"}},this.brBaseNodeGeneric={\u03a6\u03a6type:"option",\u03a6\u03a6default:"wins",\u03a6\u03a6next:!0,wins:this.nodeGeneric,kills:this.nodeGeneric,plays:this.nodeGeneric,deaths:this.nodeGeneric},this.skills=["total","total_xp","accuracy","strength","defense","health","magic","alchemy","woodcutting","farming","fishing","cooking","jewelry","carpentry","forging","mining","breeding","fletching","archery","wizardry","fungiculture","party","skill_quest","kill_quest","cathedral","scavenger_hunt"],this.challenges=["party","skill_quest","kill_quest","cathedral","scavenger_hunt","battle_royale"],this.isLoadCharjs=!1,this.V=0,this.W=0,this.finishedLoading=!1,this.optionNodeTree.\u03a6\u03a6type="option",this.optionNodeTree.\u03a6\u03a6next=!0,this.skills.forEach(s=>{this.optionNodeTree[s]=this.nodeGeneric}),this.optionNodeTree.battle_royale={\u03a6\u03a6type:"option",\u03a6\u03a6default:"solo",\u03a6\u03a6next:!0,solo:this.brBaseNodeGeneric,duo:this.brBaseNodeGeneric,trio:this.brBaseNodeGeneric},this.optionNodeTree.player={\u03a6\u03a6type:"name"},this.skills.push("battle_royale")}loadCharjs(){this.isLoadCharjs||(this.isLoadCharjs=!0,this.http.get("./assets/version.json?"+(0,g.$L)(60)).subscribe(e=>{let t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="./assets/char.js?"+e.c,t.onload=()=>{this.loadImages()},document.body.appendChild(t)}))}loadImages(){for(var e in E)"object"==typeof E[e]&&/wearable/.test(E[e].url)&&(this.V++,E[e].url="assets/"+E[e].url+"?"+w[parseInt(e)-1]+window.location.hostname,E[e].a=[],E[e].mb=E[e].B/2<<0,E[e].lb=E[e].A/2<<0,E[e].a[0]=this.v(E[e].url,()=>{this.W++,this.W==this.V&&(this.finishedLoading=!0)}))}v(e,t){var i=document.createElement("img");return i.crossOrigin="anonymous",i.src=e,i.onload=t||function(){},i}init(){this.outputData=[],this.snapShot=[],this.requestState.next(d.NONE)}parseUrl(e,t=!1){if(0==e.length)return void this.init();let i=this.optionNodeTree,s=0,l=!0,r=[];for(;l;){let a=i.\u03a6\u03a6type;if(l=i.\u03a6\u03a6next,"number"==a&&(0,g.hj)(e[s])?r.push(parseInt(e[s])):"option"==a&&i[e[s]]?r.push(e[s]):"name"==a&&e.length>1?(e[s]=e[s].usernamify(),""!=e[s]&&r.push(e[s]),e[s+1]&&(e[s+1]=e[s+1].usernamify(),""!=e[s+1]&&e[s+1]!=e[s]&&r.push(e[s+1]))):null!=i.\u03a6\u03a6default?(e[s]=i.\u03a6\u03a6default,r.push(i.\u03a6\u03a6default)):(r=[],l=!1),s++,l){let h=r[r.length-1];i=i["rank"==h?"page":h]}}this.requestState.next(d.LOADING),this.snapShot=r.map(a=>a),"battle_royale"==this.snapShot[0]&&(this.brMode=this.snapShot[1],this.brStat=this.snapShot[2]),this.setUrl(r,t),this.requestData(r)}setUrl(e,t=!1){e.length||this.init();let i="/highscore";e.forEach(s=>{i+="/"+encodeURIComponent(s)}),t?this.location.replaceState(i):this.location.go(i)}requestData(e){var t=this;return function $(o){return function(){var c=this,e=arguments;return new Promise(function(t,i){var s=o.apply(c,e);function l(a){b(s,t,i,l,r,"next",a)}function r(a){b(s,t,i,l,r,"throw",a)}l(void 0)})}}(function*(){if(!e.length)return;yield(0,g.gw)(50);let i=[e[0]];"player"==e[0]?i=e:"battle_royale"==e[0]&&(i=[`br_${t.brMode.charAt(0)}_${t.brStat.charAt(0)}`]);let s="battle_royale"==e[0]?3:1;"player"!=e[0]&&(i.push(e[s+1]),"rank"==e[s]&&(i[1]=Math.floor((e[s+1]-1)/500)),t.page=i[1]),"player"==t.snapShot[0]?(i.shift(),t.getPlayerData(i)):t.getSkillListData(i)})()}getPlayerData(e){this.isLoadCharjs||this.loadCharjs(),this.outputData=[];for(let i=0;i<e.length;i++)this.playerScores[e[i]]?this.outputData.push(e[i]):(this.outputData.push(!1),this.loadPlayer(e,i));let t=!0;this.outputData.forEach(i=>t=t&&i),t&&this.isLoadCharjs&&this.tryCompelete()}tryCompelete(){this.finishedLoading?this.requestState.next(d.COMPELETE):setTimeout(()=>{this.tryCompelete()},100)}loadPlayer(e,t){let i=e[t],s=this.http.get(this.highscore_url+"playerskills?n="+encodeURIComponent(i)+"&t="+(0,g.$L)(600)),l=this.http.get(this.highscore_url+"playerhash?n="+encodeURIComponent(i)+"&t="+(0,g.$L)(600));(0,T.D)([s,l]).subscribe({next:r=>{this.playerScores[i]=this.formatPlayerData(r[0],r[1]),this.outputData[t]=i;let a=!0;this.outputData.forEach(h=>a=a&&h),a&&this.tryCompelete()},error:()=>{this.outputData=[this.dict.err],this.requestState.next(d.ERROR)}})}formatPlayerData(e,t){let i={};return null==e.length&&(e=[]),this.skills.forEach(s=>{i[s]={},e.forEach(l=>{l.board==s&&(i[s]={score:l.score,position:l.position,last_score:l.last_score,last_position:l.last_position})})}),i.h=t.h,i.t=t.t,i}getSkillListData(e){let t=this.highscore_url+"highscores?b="+e[0]+"&p="+e[1]+"&t="+(0,g.$L)(600);this.http.get(t).subscribe({next:i=>{0==i.length?(this.outputData=[this.dict.noData],this.requestState.next(d.ERROR)):(this.outputData=[i],this.requestState.next(d.COMPELETE))},error:i=>{this.outputData=[this.dict.err],this.requestState.next(d.ERROR)}})}}return o.\u0275fac=function(e){return new(e||o)(n.LFG(_.Ye),n.LFG(k.eN),n.LFG(n.Lbi))},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var d=(()=>{return(o=d||(d={}))[o.NONE=0]="NONE",o[o.LOADING=1]="LOADING",o[o.COMPELETE=2]="COMPELETE",o[o.ERROR=3]="ERROR",d;var o})();const m=[{o:"total",t:"\u7E3D\u7B49\u7D1A"},{o:"total_xp",t:"\u7E3D\u7D93\u9A57"},{o:"accuracy",t:"\u7CBE\u6E96"},{o:"strength",t:"\u529B\u91CF"},{o:"defense",t:"\u9632\u79A6"},{o:"health",t:"\u751F\u547D"},{o:"magic",t:"\u9B54\u6CD5"},{o:"alchemy",t:"\u7149\u91D1"},{o:"woodcutting",t:"\u4F10\u6728"},{o:"farming",t:"\u8015\u7A2E"},{o:"fishing",t:"\u91E3\u9B5A"},{o:"cooking",t:"\u70F9\u98EA"},{o:"jewelry",t:"\u73E0\u5BF6"},{o:"carpentry",t:"\u6728\u5DE5"},{o:"forging",t:"\u935B\u9020"},{o:"mining",t:"\u6316\u7926"},{o:"breeding",t:"\u98FC\u990A"},{o:"fletching",t:"\u88FD\u7BAD"},{o:"archery",t:"\u7BAD\u8853"},{o:"wizardry",t:"\u5DEB\u8853"},{o:"fungiculture",t:"\u83CC\u57F9"},{o:"party",t:"\u968A\u4F0D\u4EFB\u52D9"},{o:"skill_quest",t:"\u6280\u80FD\u4EFB\u52D9"},{o:"kill_quest",t:"\u6230\u9B25\u4EFB\u52D9"},{o:"cathedral",t:"\u5927\u6559\u5802"},{o:"scavenger_hunt",t:"\u5C0B\u5BF6\u904A\u6232"},{o:"battle_royale",t:"\u5927\u9003\u6BBA"}],L=["hs_menu"];function O(o,c){if(1&o){const e=n.EpF();n.ynx(0),n.TgZ(1,"div",17),n.NdJ("click",function(){n.CHM(e);const i=n.oxw().$implicit,s=n.oxw();return n.KtG(s.displaySkill(i.o,0))}),n._UZ(2,"div",18),n._uU(3),n.qZA(),n.BQk()}if(2&o){const e=n.oxw(),t=e.$implicit,i=e.index;n.xp6(1),n.MGl("id","skill_",t.o,""),n.xp6(1),n.Akn("background-position-x:"+-24*i+"px"),n.xp6(1),n.hij("",t.t," ")}}function A(o,c){if(1&o&&(n.ynx(0),n.YNc(1,O,4,4,"ng-container",16),n.BQk()),2&o){const e=c.$implicit,t=n.oxw();n.xp6(1),n.Q6J("ngIf",!t.isChallenge(e.o))}}function I(o,c){if(1&o){const e=n.EpF();n.ynx(0),n.TgZ(1,"div",19),n.NdJ("click",function(){n.CHM(e);const i=n.oxw().$implicit,s=n.oxw();return n.KtG(s.displaySkill(i.o,0))}),n._UZ(2,"div",18),n._uU(3),n.qZA(),n.BQk()}if(2&o){const e=n.oxw(),t=e.$implicit,i=e.index;n.xp6(1),n.MGl("id","skill_",t.o,""),n.xp6(1),n.Akn("background-position-x:"+-24*i+"px"),n.xp6(1),n.hij("",t.t," ")}}function G(o,c){if(1&o&&(n.ynx(0),n.YNc(1,I,4,4,"ng-container",16),n.BQk()),2&o){const e=c.$implicit,t=n.oxw();n.xp6(1),n.Q6J("ngIf",t.isChallenge(e.o))}}let R=(()=>{class o{constructor(e,t){this.platformId=e,this.highscoreService=t,this.is_close=!1,this.SKILL_LIST=m}displayPlayer(e,t){13==t&&(this.highscoreService.parseUrl(["player",this.hs_menu.nativeElement.querySelector("#filter_player1").value,this.hs_menu.nativeElement.querySelector("#filter_player2").value]),e.preventDefault())}displaySkill(e,t){this.highscoreService.requestState.getValue()?this.highscoreService.requestState.next(0):this.highscoreService.requestState.next(1);let i=[e,"page",t];"battle_royale"==e&&(i=[e,`br_${this.highscoreService.brMode}_${this.highscoreService.brStat}`,"page",t]),this.highscoreService.parseUrl(i)}elementActive(e){this.removeElementsActive(),this.hs_menu.nativeElement.querySelector(`#skill_${e}`)?.classList.add("active")}removeElementsActive(){this.highscoreService.skills.forEach(e=>{this.hs_menu.nativeElement.querySelector(`#skill_${e}`)?.classList.remove("active")})}toggleMenu(){!this.is_close||this.hs_menu.nativeElement.classList.toggle("close")}isChallenge(e){return this.highscoreService.challenges.includes(e)}ngAfterViewInit(){!(0,_.NF)(this.platformId)||(this.requestStateSubscription=this.highscoreService.requestState.subscribe(e=>{switch(e){case d.LOADING:this.hs_menu.nativeElement.classList.add("hidden2"),this.is_close=!1;break;case d.ERROR:this.hs_menu.nativeElement.classList.remove("hidden2"),this.hs_menu.nativeElement.classList.add("close"),this.is_close=!0;break;case d.COMPELETE:this.hs_menu.nativeElement.classList.remove("hidden2"),this.hs_menu.nativeElement.classList.add("close"),this.elementActive(this.highscoreService.snapShot[0]),this.is_close=!0;break;default:this.hs_menu.nativeElement.classList.remove("close"),this.hs_menu.nativeElement.classList.remove("hidden2"),this.is_close=!1,this.removeElementsActive()}}))}ngOnDestroy(){this.requestStateSubscription?.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(n.Y36(n.Lbi),n.Y36(S))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-btn-menu"]],viewQuery:function(e,t){if(1&e&&n.Gf(L,5),2&e){let i;n.iGM(i=n.CRH())&&(t.hs_menu=i.first)}},decls:20,vars:2,consts:function(){let c,e,t,i,s,l,r;return c="\u5C55\u958B",e="\u6280\u80FD",t="\u6311\u6230",i="\u6BD4\u8F03 / \u904E\u6FFE\u73A9\u5BB6",s="\u73A9\u5BB6\u540D\u7A31",l="\u73A9\u5BB6\u540D\u7A31",r="\u904E\u6FFE",[[1,"hs_menu"],["hs_menu",""],[1,"select","expand",3,"click"],c,[1,"panel_layout"],e,["id","skills_panel",1,"panel"],[4,"ngFor","ngForOf"],t,["id","challenges_panel",1,"panel"],i,["id","player_panel"],["type","text","id","filter_player1","placeholder",s,3,"keypress"],["type","text","id","filter_player2","placeholder",l,3,"keypress"],[1,"skill",3,"click"],r,[4,"ngIf"],[1,"skill",3,"id","click"],[1,"skill_icon"],[1,"skill","challenge",3,"id","click"]]},template:function(e,t){1&e&&(n.TgZ(0,"div",0,1)(2,"div",2),n.NdJ("click",function(){return t.toggleMenu()}),n.SDv(3,3),n.qZA(),n.TgZ(4,"div",4)(5,"h4"),n.SDv(6,5),n.qZA(),n.TgZ(7,"div",6),n.YNc(8,A,2,1,"ng-container",7),n.qZA(),n.TgZ(9,"h4"),n.SDv(10,8),n.qZA(),n.TgZ(11,"div",9),n.YNc(12,G,2,1,"ng-container",7),n.qZA(),n.TgZ(13,"h4"),n.SDv(14,10),n.qZA(),n.TgZ(15,"div",11)(16,"input",12),n.NdJ("keypress",function(s){return t.displayPlayer(s,s.keyCode)}),n.qZA(),n.TgZ(17,"input",13),n.NdJ("keypress",function(s){return t.displayPlayer(s,s.keyCode)}),n.qZA(),n.TgZ(18,"button",14),n.NdJ("click",function(s){return t.displayPlayer(s,13)}),n.SDv(19,15),n.qZA()()()()),2&e&&(n.xp6(8),n.Q6J("ngForOf",t.SKILL_LIST),n.xp6(4),n.Q6J("ngForOf",t.SKILL_LIST))},dependencies:[_.sg,_.O5],styles:['.hs_menu[_ngcontent-%COMP%]{display:inline-block;margin-bottom:50px}.hs_menu.hidden2[_ngcontent-%COMP%]   .panel_layout[_ngcontent-%COMP%], .hs_menu.close[_ngcontent-%COMP%]   .panel_layout[_ngcontent-%COMP%]{display:none}.hs_menu[_ngcontent-%COMP%]   .panel_layout[_ngcontent-%COMP%]{padding-bottom:50px}.skill[_ngcontent-%COMP%]{background:#333;color:#fff;padding:6px 9px 6px 3px;border:1px solid #333;box-shadow:0 0 2px #141414 inset;line-height:20px;position:relative;cursor:pointer;transition:.3s;display:flex;align-items:center}.skill[_ngcontent-%COMP%]   .skill_icon[_ngcontent-%COMP%]{background:url(assets/img/skill_level_up.png);width:24px;height:20px;background-size:cover;margin-right:3px}.skill.challenge[_ngcontent-%COMP%]{background:#344c68}.skill[_ngcontent-%COMP%]:hover{background:#436c72;scale:1.05}.skill.active[_ngcontent-%COMP%]{background:#ffc75f;color:#000;text-shadow:1px 1px #aaa;scale:1.05}#player_panel[_ngcontent-%COMP%]{width:180px;display:flex;flex-direction:column;align-items:flex-start;gap:6px}#player_panel[_ngcontent-%COMP%]   .skill[_ngcontent-%COMP%]{padding:6px 9px}.panel_layout[_ngcontent-%COMP%]{display:flex;flex-direction:column;box-shadow:0 0 2px #141414 inset;background:#424242;border:1px solid #333;padding:6px;margin-top:3px}.panel_layout[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;flex-wrap:wrap;gap:6px;margin:3px}.expand[_ngcontent-%COMP%]{cursor:pointer;width:-moz-fit-content;width:fit-content;padding:10px 30px;line-height:18px}.expand[_ngcontent-%COMP%]:after{background:#fff;width:12px;border-width:0 5px 0 5px;clip-path:polygon(0% 20%,50% 70%,100% 20%);content:"";display:inline-block;height:12px;margin:0 -8px 0 8px}h4[_ngcontent-%COMP%]{margin-bottom:0}h4[_ngcontent-%COMP%]:first-child{margin:0}@media screen and (max-width: 500px){.skill[_ngcontent-%COMP%]{line-height:36px;font-size:1.2em}input[_ngcontent-%COMP%]{line-height:36px}.expand[_ngcontent-%COMP%]{line-height:28px}}'],changeDetection:0}),o})();const B=["content"];let H=(()=>{class o{constructor(e,t){this.hs=e,this.platformId=t,this.dict={noInTop:"\u672A\u4E0A\u699C",level:"\u7B49\u7D1A",xp:"\u7D93\u9A57 (\u767E\u842C)",point:"\u9EDE\u6578",rank:"\u6392\u540D",player:"\u73A9\u5BB6"}}ngAfterViewInit(){if(this.container=this.content.nativeElement.querySelector("#hs_output"),!(0,_.NF)(this.platformId))return;this.container.innerHTML="";let e=this.content.nativeElement.querySelector("#hs_loading"),t=this.content.nativeElement.querySelector("#hs_err_output");this.requestState$=this.hs.requestState.subscribe(i=>{switch(this.container?.classList.add("hidden"),e?.classList.add("hidden"),t?.classList.add("hidden"),i){case d.LOADING:e.classList.remove("hidden");break;case d.ERROR:t.classList.remove("hidden"),t.innerText=this.hs.outputData[0];break;case d.COMPELETE:this.renderData(),this.container.classList.remove("hidden")}})}renderData(){if("player"==this.hs.snapShot[0]){if(!this.hs.finishedLoading)return void setTimeout(()=>{this.renderData()},100);3==this.hs.snapShot.length?this.renderCompareData():this.renderPlayerData()}else this.renderSkill();this.scroll2Target()}ngOnDestroy(){this.requestState$.unsubscribe()}renderSkill(){let t=this.hs.snapShot[0],i=this.dict.level;"total_xp"==t?i=this.dict.xp:(-1!=["party","scavenger_hunt","skill_quest","kill_quest","battle_royale"].indexOf(t)||/br_/.test(t))&&(i=this.dict.point);let s=`<table class='hs_table table_skill'><thead><tr class='field_name'>\n    <td colspan='2'>${this.dict.rank}</td>\n    <td>${this.dict.player}</td>\n    <td colspan='2'>${i}</td>\n    </tr></thead><tbody>`;this.hs.outputData[0].forEach(l=>{s+=`<tr><td>${this.formatSkillLevel(l.position,!0,t)}</td>\n      <td>${this.colorifyNumber(l.position,l.last_position,!0,t)}</td>\n      <td>${l.player}</td>\n      <td>${this.formatSkillLevel(l.score,!1,t)}</td>\n      <td>${this.colorifyNumber(l.score,l.last_score,!1,t)}</td>\n      </tr>`}),s+="</tbody></table>",this.container.innerHTML=s,this.container.querySelectorAll("tbody td:nth-child(1)").forEach(l=>{l.classList.add("btn"),l.addEventListener("click",()=>{this.displayRank(parseInt(l.innerHTML.replace(",","")))})}),this.container.querySelectorAll("tbody td:nth-child(3)").forEach(l=>{l.classList.add("btn"),l.addEventListener("click",()=>{this.hs.parseUrl(["player",l.innerHTML])})}),this.renderPageBtn(),"battle_royale"==this.hs.snapShot[0]&&this.renderBattleRoyaleOptions(),this.renderTitle(),this.scroll2Target()}renderPageBtn(){let e,t;if(this.hs.outputData[0].length>=500&&(e=document.createElement("div"),e.className="next_page",e.innerText="\u4E0B\u4E00\u9801",e.addEventListener("click",i=>{let s="battle_royale"==this.hs.snapShot[0]?2:0;this.hs.snapShot[1+s]="page",this.hs.snapShot[2+s]=this.hs.page+1,this.hs.parseUrl(this.hs.snapShot)})),0!=this.hs.page&&(t=document.createElement("div"),t.className="prev_page",t.innerText="\u4E0A\u4E00\u9801",t.addEventListener("click",i=>{let s="battle_royale"==this.hs.snapShot[0]?2:0;this.hs.snapShot[1+s]="page",this.hs.snapShot[2+s]=this.hs.page-1,this.hs.parseUrl(this.hs.snapShot)})),e||t){let i=document.createElement("tfoot");i.innerHTML="<tr><td colspan='5'></td></tr>",document.querySelector(".hs_table").append(i);let s=document.querySelector(".hs_table tfoot td");t&&s?.append(t),e&&s?.append(e)}}renderTitle(){let e=this.hs.snapShot[0],t=-1;m.forEach((r,a)=>{r.o==e&&(t=a)});let i=document.createElement("tr");i.innerHTML=`<td colspan='5'><div class='badge_base'>\n    <div class='badge_deco'></div>\n    <div class='badge_skill' style="background-position-x: -${36*t}px;"></div>\n    <div class='badge_label'>${m[t].t}</div>\n    </div></td>`;let l=this.container.querySelector(".hs_table thead");l.insertBefore(i,l.firstChild)}scroll2Target(){let e=this.hs.snapShot,t="battle_royale"==e[0]?2:0;setTimeout(i=>{if("player"!=e[0]&&"rank"==e[1+t]){let s=parseInt(e[2+t])%500;s=0==s?500:s,this.scroll2Elm(`.hs_table tbody tr:nth-child(${s})`,!0)}else this.scroll2Elm("player"==e[0]?".hs_table thead tr:nth-child(1)":".badge_deco",!0)},100)}scroll2Elm(e,t){let i=50,s=setInterval(l=>{i--<=0&&clearInterval(s),document.querySelector(e)&&(document.querySelector(e).scrollIntoView({behavior:"smooth",block:"center"}),t&&document.querySelector(e).classList.add("highlight"),clearInterval(s))},100)}renderBattleRoyaleOptions(){let e=document.createElement("select");e.id="br_mode",[{v:"solo",n:"\u55AE\u4EBA"},{v:"duo",n:"\u96D9\u4EBA"},{v:"trio",n:"\u4E09\u4EBA"}].forEach(i=>{e.innerHTML+=`<option value='${i.v}'>${i.n}</option>`}),e.value=this.hs.brMode,e.addEventListener("change",i=>{this.displayBattleRoyale(i)});let t=this.container.querySelector(".hs_table thead");t.innerHTML="<tr><td colspan='5'></td></tr>"+t.innerHTML,t=this.container.querySelector(".hs_table thead td"),t?.append(e),e=document.createElement("select"),e.id="br_stat",[{v:"wins",n:"\u52DD\u5229"},{v:"kills",n:"\u64CA\u6BBA"},{v:"plays",n:"\u904A\u73A9"},{v:"deaths",n:"\u6B7B\u4EA1"}].forEach(i=>{e.innerHTML+=`<option value='${i.v}'>${i.n}</option>`}),e.value=this.hs.brStat,e.addEventListener("change",i=>this.displayBattleRoyale(i)),t?.append(e)}displayBattleRoyale(e){this.hs.brMode=document.getElementById("br_mode").value,this.hs.brStat=document.getElementById("br_stat").value,this.hs.parseUrl(["battle_royale",this.hs.brMode,this.hs.brStat,"page",0])}displayRank(e){e<0||(document.querySelectorAll("tr").forEach(t=>{t.classList.remove("highlight")}),document.querySelectorAll("tbody tr")[(e-1)%500].classList.add("highlight"),this.hs.setUrl("battle_royale"==this.hs.snapShot[0]?[this.hs.snapShot[0],this.hs.brMode,this.hs.brStat,"rank",e]:[this.hs.snapShot[0],"rank",e]))}renderCompareData(){let e=this.hs.snapShot,t=e[1],i=this.hs.playerScores[t],s=e[2],l=this.hs.playerScores[s],r=`<table class='hs_table compare'><thead>\n      <tr><td colspan='2'>${this.renderCanvas("canvas_player1")}</td><td class='vs' rowspan='2'>VS</td><td colspan='2'>${this.renderCanvas("canvas_player2")}</td></tr>\n      <tr><td colspan='2' class='name'>${this.renderPlayerTag(i.t)}${t}</td>\n    <td colspan='2' class='name'>${this.renderPlayerTag(l.t)}${s}</td></tr>\n<tr class='field_name'><td>${this.dict.rank}</td><td>${this.dict.point}</td><td></td>\n<td>${this.dict.point}</td><td>${this.dict.rank}</td></tr>\n    </thead><tbody>`;if(m.forEach(N=>{let p=N.o;"battle_royale"!=p&&(r+=`<tr${this.colorClass(i[p].score,l[p].score)}>\n      <td>${i[p].position?this.formatSkillLevel(i[p].position,!0,p):this.dict.noInTop}</td>\n      <td>${i[p].score?this.formatSkillLevel(i[p].score,!1,p):""}</td>\n      <td>${N.t}</td>\n      <td>${l[p].score?this.formatSkillLevel(l[p].score,!1,p):""}</td>\n      <td>${l[p].position?this.formatSkillLevel(l[p].position,!0,p):this.dict.noInTop}</td>\n      </tr>`)}),r+="</tbody></table>",this.container.innerHTML=r,i.h){var h=document.getElementById("canvas_player1").getContext("2d");(f=v).params.hash=i.h,h.clearRect(0,0,64,64),Draw.drawPlayer(h,f,C)}var f;l.h&&(h=document.getElementById("canvas_player2").getContext("2d"),(f=v).params.hash=l.h,h.clearRect(0,0,64,64),Draw.drawPlayer(h,f,C))}renderPlayerTag(e){return e?`<span style='color:yellow;margin:0 5px;font-size:smaller;'>[${e}]</span>`:""}renderCanvas(e){return`<canvas id='${e}' width='64' height='64' style='margin: -25px auto;width:128px;height:128px;display:block;image-rendering:pixelated;image-rendering:-moz-crisp-edges;-ms-interpolation-mode:nearest-neighbor;'></canvas>`}renderPlayerData(){let e=this.hs.snapShot[1],t=this.hs.playerScores[e],i=`<table class='hs_table single'\n    ><thead><tr><td colspan='5'>${this.renderCanvas("canvas_player1")}</td></tr>\n    <tr><td colspan='5' class='name'>${this.renderPlayerTag(t.t)}${e}</td></tr>\n    <tr class='field_name'><td colspan='2'>${this.dict.rank}</td><td></td><td colspan='2'>${this.dict.point}</td></tr>\n    </thead><tbody>`;if(m.forEach(a=>{let h=a.o;"battle_royale"!=h&&(i+=`<tr>\n      <td>${t[h].position?this.formatSkillLevel(t[h].position,!0,h):this.dict.noInTop}</td>\n      <td>${this.colorifyNumber(t[h].position,t[h].last_position,!0,h)}</td>\n      <td>${a.t}</td>\n      <td>${t[h].score?this.formatSkillLevel(t[h].score,!1,h):""}</td>\n      <td>${this.colorifyNumber(t[h].score,t[h].last_score,!1,h)}</td>\n      </tr>`)}),i+="</tbody></table>",this.container.innerHTML=i,t.h){var l=document.getElementById("canvas_player1").getContext("2d"),r=v;r.params.hash=t.h,l.clearRect(0,0,64,64),Draw.drawPlayer(l,r,C)}}colorClass(e,t){return e==t?"":e>t||!t?" class='p1'":" class='p2'"}colorifyNumber(e,t,i,s){if(!e||!t||"scavenger_hunt"==s)return"";var l=' class="green"',r=' class="red"',a=Math.abs(e-t);return e<t?i?" <span"+l+">(+"+this.formatSkillLevel(a,i,s)+")</span>":" <span"+r+">(-"+this.formatSkillLevel(a,i,s)+")</span>":e>t?i?" <span"+r+">(-"+this.formatSkillLevel(a,i,s)+")</span>":" <span"+l+">(+"+this.formatSkillLevel(a,i,s)+")</span>":""}formatSkillLevel(e,t,i){if(!e)return"";let s=e.toString();return!t&&"total_xp"==i&&(s=(e/10).toFixed(1)),s=this.addComma(s),s}addComma(e){if(""!=e){var t=(e+="").split(".");return t[0].replace(/(\d{1,3})(?=(\d{3})+$)/g,"$1,")+(2==t.length?"."+t[1]:"")}return""}}return o.\u0275fac=function(e){return new(e||o)(n.Y36(S),n.Y36(n.Lbi))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-data-container"]],viewQuery:function(e,t){if(1&e&&n.Gf(B,5),2&e){let i;n.iGM(i=n.CRH())&&(t.content=i.first)}},decls:5,vars:0,consts:[["content",""],["id","hs_err_output",1,"message_box"],["id","hs_loading",1,"message_box"],["id","hs_output",1,"message_box"]],template:function(e,t){1&e&&(n.TgZ(0,"div",null,0),n._UZ(2,"div",1)(3,"div",2)(4,"div",3),n.qZA())},styles:[".message_box[_ngcontent-%COMP%]{margin:0}#hs_output[_ngcontent-%COMP%]{display:block}#hs_output.hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0}),o})();const v={params:{head:0,facial_hair:0,body:0,pants:0,cape:0,left_hand:0,right_hand:0,shield:0,helmet:0,boots:0,weapon:0,hash:null}},C={x:6,y:32,relative:!1};let z=(()=>{class o{constructor(e,t,i){this.route=e,this.highscoreService=t,this.router=i}ngOnInit(){this.navigationSubscription=this.router.events.subscribe(e=>{e instanceof y.m2&&this.parseUrl()}),this.parseUrl()}parseUrl(){let e=[];this.route.snapshot.url.forEach(t=>{e.push(decodeURI(t.path.toLocaleLowerCase()))}),this.highscoreService.parseUrl(e,!0)}ngOnDestroy(){this.navigationSubscription?.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(n.Y36(y.gz),n.Y36(S),n.Y36(y.F0))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-highscore"]],decls:5,vars:0,consts:function(){let c;return c="\u9AD8\u5206\u699C",[[1,"hs_container"],c,[1,"unselectable"]]},template:function(e,t){1&e&&(n.TgZ(0,"div",0)(1,"h3"),n.SDv(2,1),n.qZA(),n._UZ(3,"app-btn-menu",2)(4,"app-data-container"),n.qZA())},dependencies:[R,H],changeDetection:0}),o})();String.prototype.sanitize||(String.prototype.sanitize=function(){return this.replace(/[^A-Za-z-_0-9\u00fc\u00f5\u00f6\u00e4\u00d6\u00c4\u00d5\u00dc\u0161\u0160\u017e\u017d\@#$%^"'; \?!\.,'()\=\+\-\*\/:]/g,"")}),String.prototype.username||(String.prototype.username=function(){return this.sanitize().trim().replace(/ +(?= )/g,"").replace(/\/|\\/g,"").trim()}),String.prototype.usernamify||(String.prototype.usernamify=function(){return this.toLowerCase().username().substr(0,16)});let D=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[_.ez,y.Bz.forChild([{path:"**",component:z}]),x.u5]}),o})()}}]);